<module href="./src/layouts/full.html" title="Public More">
	<div data-holy>
		<!-- <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js" async></script> -->
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.10.2/lottie_light.min.js" async></script> -->
		<include src="scripts/lottie.html"></include>
		<include src="scripts/petite-vue.html"></include>

		<style>
			@import "./scss/fonts.scss";
			@import "./scss/style.scss";
		</style>

		<include src="sections/hero.html"></include>
		<include src="sections/payments.html"></include>
		<include src="sections/deliveries.html"></include>
		<include src="sections/support.html"></include>
		<include src="sections/rewards.html"></include>
		<include src="sections/enviroment.html"></include>
		<include src="sections/more.html"></include>
		<script>
			;(function () {
				var mediaQuery = window.matchMedia("(max-width: 1023px)")
				var pageHeader = document.querySelector("#header")
				var heroSection = document.querySelector(".categories")
				var categories = document.querySelector(".categories")
				var heroSection = document.querySelector(".section--hero")
				var pageHeaderHeight = pageHeader.getBoundingClientRect().height
				var categoriesTop = categories.getBoundingClientRect().top
				var categoriesHeight = categories.getBoundingClientRect().height
				var distanceToScroll = categoriesTop - (pageHeaderHeight + 16)
				var searchForm = document.querySelector(".searchform")
				var searchResultList = document.querySelector(".searchform__results-list")
				var pageLink = window.location.href

				function fixIt() {
					if (categories.classList.contains("categories--fixed")) return
					console.log(!categories.classList.contains("categories--fixed"), "not fixed")
					categories.classList.add("categories--fixed")
					categories.style.top = pageHeader.getBoundingClientRect().height + "px"
					heroSection.style.marginBottom =
						parseInt(getComputedStyle(searchForm).marginBottom) + categoriesHeight
				}

				function unFixIt() {
					if (!categories.classList.contains("categories--fixed")) return
					console.log(categories.classList.contains("categories--fixed"), "fixed")
					categories.classList.remove("categories--fixed")
					categories.removeAttribute("style")
					heroSection.removeAttribute("style")
				}

				function handleScroll() {
					// console.log(mediaQuery.matches, window.scrollY >= distanceToScroll, "scrolling")
					if (!mediaQuery.matches) {
						unFixIt()
						return
					}

					if (window.scrollY >= distanceToScroll) {
						fixIt()
						return
					}
					unFixIt()
				}

				function loadFunctionality() {
					if (typeof lottie === "undefined" || typeof PetiteVue === "undefined") {
						console.log("lottie/vue waiting room...")
						return
					}

					console.log({ PetiteVue, lottie })
					const store = PetiteVue.reactive({
						payments: "flexpay",
						deliveries: "next-day-delivery",
						support: "safetynet",
						more: "publicbusiness",
						searchData: [
							{
								id: "payments",
								text: "Πληρωμές Φέρνουμε τις αγορές στα μέτρα σου",
								type: "section",
							},
							{
								id: "deliveries",
								text: "Παραδόσεις Παραδίδουμε ό,τι χρειάζεσαι με μεγαλύτερη ευκολία και ευελιξία από ποτέ!",
								type: "section",
							},
							{
								id: "support",
								text: "Προστασία & Express Επισκευή Μετά την απομάκρυνση από το ταμείο, μένουμε δίπλα σου!",
								type: "section",
							},
							{
								id: "more",
								text: "More & More Περισσότερες ευκολίες για να απολαμβάνεις περισσότερα!",
								type: "section",
							},
							{
								id: "rewards",
								text: "Πρόγραμμα επιβράβευσης StudentClub MyClub Κάνε Εγγραφή",
								heading: "Πρόγραμμα Επιβράβευσης",
								type: "section",
							},
							{
								id: "enviroment",
								text: "eco Με λύσεις για να κάνεις καλό στο περιβάλλον, αλλά και οικονομία!",
								heading: "Ecology",
								type: "section",
							},
							{
								id: "tradensave",
								text: "trade&save eco Επίστρεψε την παλιά σου συσκευή για νέες αγορές με κέρδος έως και 1.000€!",
								heading: "trade&save",
								type: "service",
							},
							{
								id: "refurbished",
								text: "Refurbished προϊόντα με εγγύηση ποιότητας Επίλεξε μία ανακατασκευασμένη συσκευή και απόλαυσε 50% εξοικονόμηση χρημάτων και έως 12 μήνες εγγύηση!",
								heading: "Refurbished προϊόντα",
								type: "service",
							},
							{
								id: "love-earth",
								text: "Love Earth για έναν βιώσιμο πλανήτη",
								heading: "Love Earth",
								type: "service",
							},
							{
								id: "next-day-delivery",
								group: "deliveries",
								text: "next day delivery Παράλαβε στην πόρτα σου την επόμενη μέρα! 100.000 άμεσα διαθέσιμα προϊόντα έρχονται στην πόρτα σου την επόμενη κιόλας μέρα!",
								type: "service",
							},
							{
								id: "flex-delivery",
								group: "deliveries",
								text: "flex delivery Επίλεξε ημερομηνία παράδοσης στο χώρο σου για 30 μέρες! Αν είσαι στην Αττική και θες περισσότερη ευελιξία, έχεις 30 ημέρες για να επιλέξεις ακριβώς τη μέρα και ώρα που θα παραλάβεις!",
								type: "service",
							},
							{
								id: "locker-pickup",
								group: "deliveries",
								text: "locker-pickup Παράλαβε όποτε θες από 1.200 BOX NOW lockers πανελλαδικά! Βρες το κοντινότερο BOX NOW locker σου ανάμεσα σε 1.200 σημεία σε όλη την Ελλάδα, και παράλαβε με 1€ όπου και όποτε θες, χωρίς να κοιτάς το ρολόι!",
								type: "service",
							},
							{
								id: "expresspickup",
								group: "deliveries",
								text: "expresspickup Παράλαβε από το αγαπημένο σου κατάστημα σε 60'! Παράγγειλε online το αγαπημένο σου προϊόν ανάμεσα σε χιλιάδες επιλογές και παράλαβέ το από ένα κατάστημα",
								type: "service",
							},
							{
								id: "flexpay",
								group: "payments",
								text: "flexpay Eξόφλησε στο χρόνο σου σε έως 36 δόσεις, χωρίς πιστωτική! Εξόφλησε το συνολικό ποσό των αγορών σου σε έως 36 δόσεις, επιλέγοντας εσύ το χρόνο και το ποσό κάθε δόσης, χωρίς πιστωτική!",
								type: "service",
							},
							{
								id: "klarna",
								group: "payments",
								text: "klarna Εξόφλησε σε 3 άτοκες δόσεις, χωρίς πιστωτική! Εξόφλησε τις αγορες σου σε δεύτερο χρονο με 3 ατοκες δοσεις και χωρις πιστωτική!",
								type: "service",
							},
							{
								id: "paypal",
								group: "payments",
								text: "paypal Πλήρωσε online με ένα click, χωρίς κάρτα! Πλήρωσε εύκολα και γρήγορα από τον Paypal λογαριασμό σου με ένα click!",
								type: "service",
							},
							{
								id: "iris",
								group: "payments",
								text: "iris Πλήρωσε απευθείας από το λογαριασμό σου, χωρίς κάρτα! Δώσε στις αγορές σου την ασφάλεια που θες με άμεση πληρωμή μέσω IRIS!",
								type: "service",
							},
							{
								id: "safetynet",
								group: "support",
								text: "safetynet Επεκτείνουμε την εγγύηση των νέων σου συσκευών για 5 χρόνια! Επεκτείνουμε την εγγύηση των νέων σου συσκευών για 5 χρόνια για να τις απολαμβάνεις ακόμα πιο ξέγνοιαστα!",
								type: "service",
							},
							{
								id: "irepair",
								group: "support",
								text: "irepair Επισκευάζουμε άμεσα και αξιόπιστα τη συσκευή σου, με την εγγύηση της iRepair! Απόλαυσε την πιο γρήγορη, οικονομική και αξιόπιστη λύση service για τη συσκευή σου σε ένα από τα επιλεγμένα καταστήματα Public & iRepair!",
								type: "service",
							},
							{
								id: "publicbusiness",
								group: "more",
								text: "publicbusiness Η all-in-one λύση για επαγγελματίες και επιχειρήσεις Απολαύστε ολοκληρωμένες λύσεις σε εξοπλισμό γραφείου, υπολογιστές, κλιματισμό, έπιπλα και ηλεκτρικές συσκευές, και εξασφαλίστε το καλύτερο για την επιχείρησή σας! Απολαύστε την all-in-one λύση για την επιχείρησή σας!",
								type: "service",
							},
							{
								id: "bookfriends",
								group: "more",
								text: "bookfriends Διαβάζουμε και σου προτείνουμε Μοιραζόμαστε μαζί σου τα πάντα για τα βιβλία που αγαπάς, με κριτικές και νέες προτάσεις αποκλειστικά για τη βιβλιοθήκη σου! Αναζήτησε κριτικές βιβλίων & προτάσεις για τη βιβλιοθήκη σου!",
								type: "service",
							},
							{
								id: "tickets",
								group: "more",
								text: "tickets Το εισιτήριο στις πιο δυνατές σου στιγμές Κλείσε εύκολα και γρήγορα εισιτήρια για παραστάσεις, συναυλίες, εκδηλώσεις και κάθε εμπειρία που θες να ζήσεις! Κλείσε το εισιτήριό σου στις πιο δυνατές σου στιγμές!",
								type: "service",
							},
							{
								id: "blog",
								group: "more",
								text: "blog Σε διαβάζουμε και προτείνουμε! Ανακάλυψε καθημερινά όλα όσα θες να γνωρίζεις, με ιδέες, νέα και συμβουλές από την ομάδα των Public Editors! Ανακάλυψε καθημερινά νέα και έξυπνα tips για όλα όσα θες να γνωρίζεις!",
								type: "service",
							},
						],
						searchValue: "",
						searchEmpty: `<li class="empty"><p><strong>Εδώ μπορείς να βρεις υπηρεσίες των Public.</strong></p><p>Αν δεν βρήκες αυτό που ψάχνεις, χρησιμοποίησε την βασική αναζήτηση της ιστοσελίδας που γράφει	"Ψάχνω για..."</p></li>`,
						searchPage() {
							if (this.searchValue === "") return
							const searchResults = this.searchData.filter((result) =>
								result.text.toLowerCase().includes(this.searchValue.toLowerCase())
							)

							if (searchResults.length > 0) {
								searchResultList.innerHTML = ""
								searchResults.map((result) => {
									const li = document.createElement("li")
									const div = document.createElement("div")
									div.onclick = () => {
										this.scrollTo(result.id, result.type, result.group)
										this.searchValue = ""
									}

									if (result.type === "section") {
										const section = document.querySelector(`#${result.id}`)
										const sectionTitle = section.querySelector(".section__title")

										div.innerText = sectionTitle ? sectionTitle.innerText : result.heading
									}

									if (result.type === "service") {
										const title = document.querySelector(`#${result.id} .tab-button__title`)

										if (!!title) {
											const titleNode = title.cloneNode(true)
											div.appendChild(titleNode)
										} else {
											div.innerHTML = result.heading
										}
									}

									li.appendChild(div)
									searchResultList.appendChild(li)
								})
							} else {
								searchResultList.innerHTML = this.searchEmpty
							}
						},
						setCurrentTab(id, active) {
							this[id] = active
						},
						scrollTo(id, type, group) {
							console.log({ id, type, group })
							if (!document.querySelector(`#${id}`)) return
							const distanceTop = type === "service" ? categoriesHeight + 116 + 32 : 116 + 32
							const top =
								document.querySelector(`#${id}`).getBoundingClientRect().top +
								window.scrollY -
								(pageHeader.getBoundingClientRect().height + mediaQuery.matches ? distanceTop : 16)
							window.scrollTo({
								top,
								left: 0,
								behavior: "smooth",
							})
							if (group === undefined) return
							this.setCurrentTab(group, id)
						},
					})

					PetiteVue.createApp(store).mount()
					lottie.loadAnimation({
						container: document.querySelector("#holy-anim"),
						path: "https://assets6.lottiefiles.com/packages/lf20_Shqi4jaJ6G.json",
						renderer: "svg",
						rendererSettings: {
							preserveAspectRatio: "none",
						},
						loop: true,
						autoplay: true,
					})
					window.removeEventListener("scroll", loadFunctionality)
				}

				document.querySelector("[data-holy]").setAttribute("style", `--header-height: ${pageHeaderHeight}px`)
				window.addEventListener("scroll", loadFunctionality, { once: true })
				window.addEventListener("scroll", handleScroll)
			})()
		</script>
	</div>
</module>
